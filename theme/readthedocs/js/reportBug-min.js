var App={error:{}};App.error.Report=function(){var e,f,v=this,t="not-visible",n="disable",w={};this.initElements=function(){w.body=oBody=$("body"),w.gridBody=oBody.children(".wy-grid-for-nav"),w.wrapper=oWrapper=$(".wrapper-send-report"),w.popupContent=oWrapper.children(":first"),w.description=oDescription=oWrapper.find(".popup-description"),w.textarea=oTextArea=w.popupContent.find(".comment"),w.note=w.popupContent.find(".rst-content"),w.selectedText=oDescription.find(".selected .text"),w.selectedParent="",w.sendBtn=w.popupContent.find(".actions .btn"),w.successForm=w.popupContent.find(".successText"),w.username=w.popupContent.find(".name .input"),w.textarea.keyup(v.enableSendBtn).focusout(v.enableSendBtn),w.body.keypress(function(e){!e.ctrlKey||10!=e.keyCode&&13!=e.keyCode||v.openReportForm()}),$("a.bug-found").on("click",v.openReportForm),w.popupContent.find(".popup-pane .btn-back").on("click",v.closeSendContent),w.sendBtn.on("click",v.sendIssue),w.body.keyup(function(e){27==e.keyCode&&(w.wrapper.addClass(t),w.gridBody.css({overflow:"scroll"}))}),w.body.on("click",function(e){"wrapper-send-report"==e.target.className&&!w.wrapper.hasClass(t)&&w.popupContent.hasClass(t)&&!w.successForm.hasClass(t)&&$(".wy-body-for-nav").has(e.target).length&&v.closeSendContent()})},this.enableSendBtn=function(){!this.value||this.value&&!this.value.trim()?w.sendBtn.addClass(n):w.sendBtn.removeClass(n)},this.preventDefaultEvent=function(e){w.wrapper.hasClass(t)||"wrapper-send-report"!=e.target.className||((e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1)},this.openReportForm=function(){if(w.wrapper.hasClass(t))return w.popupContent.removeClass(t),e=window.getSelection(),f=e.toString()||"",w.selectedParent=e.anchorNode||{},w.wrapper.removeClass(t),w.gridBody.css({overflow:"hidden"}),w.username.val()?w.textarea.focus():w.username.focus(),f?(w.sendBtn.removeClass(n),w.description.removeClass(t),w.selectedText.text(f),w.note.addClass(t)):(w.note.removeClass(t),w.description.addClass(t)),v.setCenterForm(w.popupContent),w.textarea.val()||w.sendBtn.addClass(n),!1},this.setCenterForm=function(e){var t;t=(window.innerHeight-e.height())/2,e.css({"margin-top":t+"px"})},this.closeSendContent=function(){w.successForm.addClass(t),w.wrapper.addClass(t),w.gridBody.css({overflow:"scroll"})},this.showSuccess=function(){var e="not-visible";w.successForm=$(".successText"),w.popupContent=$(".popup-content"),w.successForm.removeClass(e),v.setCenterForm(w.successForm),w.popupContent.addClass(e),setTimeout(function(){v.closeSendContent()},3e3)},this.sendIssue=function(){var e,t,n,o,s,r=new XMLHttpRequest,a=window.location.protocol+"//"+window.location.hostname+"/issue_report.php",p=w.textarea.val()||"",d=w.selectedText.text()||"",i=w.selectedParent.parentElement||{},l=w.username.val()||"",c="";if(f&&(i=i.parentElement||{},n=(o=($(i)||{}).children()||{}).index(w.selectedParent.parentElement),o.length>n))for(var u=0,m=(t=o.slice(0<n-3?n-3:0,n+3<=o.length?n+3:o.length)).length;u<m;u++)-1!=t[u].outerText.indexOf(d)?t[u].outerText.length>d.length?c+=t[u].outerText.replace(d,"\n```\n"+d+"\n```\n"):c+="\n```\n"+t[u].outerText+"\n```\n":c+=t[u].outerText+"\n";e=f?c||"```"+i.outerText+"```":"",s=encodeURI("comment="+p+"&selected="+d+"&page="+window.location.pathname+"&userName="+l+"&context="+e),r.open("POST",a,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(s),w.textarea.val(""),w.gridBody.removeClass("no-scroll"),v.showSuccess()}},function(){var e=new App.error.Report;$("body").ready(function(){e.initElements(),window.addEventListener("DOMMouseScroll",e.preventDefaultEvent,!1),window.onwheel=e.preventDefaultEvent,window.onmousewheel=document.onmousewheel=e.preventDefaultEvent,window.ontouchmove=e.preventDefaultEvent})}();