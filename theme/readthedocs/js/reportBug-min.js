var App={error:{}};App.error.Report=function(){var e,t,w=this,n="not-visible",o="disable",f={};this.initElements=function(){f.body=oBody=$("body"),f.gridBody=oBody.children(".wy-grid-for-nav"),f.wrapper=oWrapper=$(".wrapper-send-report"),f.popupContent=oWrapper.children(":first"),f.description=oDescription=oWrapper.find(".popup-description"),f.textarea=oTextArea=f.popupContent.find(".comment"),f.note=f.popupContent.find(".rst-content"),f.selectedText=oDescription.find(".selected .text"),f.selectedParent="",f.sendBtn=oSendBtn=f.popupContent.find(".actions .btn"),f.successForm=f.popupContent.find(".successText"),f.username=f.popupContent.find(".name .input"),f.textarea.keyup(w.enableSendBtn).focusout(w.enableSendBtn),f.body.keypress(function(e){!e.ctrlKey||10!=e.keyCode&&13!=e.keyCode||w.openReportForm()}),$("a.bug-found").on("click",w.openReportForm),f.body.keyup(function(e){27==e.keyCode&&(f.wrapper.addClass(n),f.gridBody.css({overflow:"scroll"}))}),f.body.on("click",function(e){"wrapper-send-report"==e.target.className&&!f.wrapper.hasClass(n)&&f.popupContent.hasClass(n)&&!f.successForm.hasClass(n)&&$(".wy-body-for-nav").has(e.target).length&&w.closeSendContent()})},this.enableSendBtn=function(){this.value&&!this.value.trim()?f.sendBtn.addClass(o):f.sendBtn.removeClass(o)},this.preventDefaultEvent=function(e){f.wrapper.hasClass(n)||"wrapper-send-report"!=e.target.className||((e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1)},this.openReportForm=function(){if(f.wrapper.hasClass(n))return f.popupContent.removeClass(n),e=window.getSelection(),t=e.toString()||"",f.selectedParent=e.anchorNode,f.wrapper.removeClass(n),f.gridBody.css({overflow:"hidden"}),f.username.val()?f.textarea.focus():f.username.focus(),t?(f.sendBtn.removeClass(o),f.description.removeClass(n),f.selectedText.text(t),f.note.addClass(n)):(f.note.removeClass(n),f.description.addClass(n)),w.setCenterForm(),f.textarea.val()||f.sendBtn.addClass(o),!1},this.setCenterForm=function(){var e;e=(window.innerHeight-f.popupContent.height())/2,f.popupContent.css({"margin-top":e+"px"})},this.closeSendContent=function(){f.successForm.addClass(n),f.wrapper.addClass(n),f.gridBody.css({overflow:"scroll"})},this.showSuccess=function(){var e="not-visible";f.successForm=$(".successText"),f.popupContent=$(".popup-content"),f.popupContent.addClass(e),f.successForm.removeClass(e),setTimeout(function(){closeSendContent()},3e3)},this.sendIssue=function(){var e,t,n,o,s,r=new XMLHttpRequest,a=window.location.protocol+"//"+window.location.hostname+"/issue_report.php",p=f.textarea.val()||"",d=f.selectedText.text()||"",i=f.selectedParent.parentElement,l=f.username.val()||"",c="";if(i=i.parentElement,n=(o=($(i)||{}).children()||{}).index(f.selectedParent.parentElement),o.length>n)for(var u=0,m=(t=o.slice(0<n-3?n-3:0,n+3<=o.length?n+3:o.length)).length;u<m;u++)-1!=t[u].outerText.indexOf(d)?t[u].outerText.length>d.length?c+=t[u].outerText.replace(d,"\n```\n"+d+"\n```\n"):c+="\n```\n"+t[u].outerText+"\n```\n":c+=t[u].outerText+"\n";e=c||"```"+i.outerText+"```",s=encodeURI("comment="+p+"&selected="+d+"&page="+window.location.pathname+"&userName="+l+"&context="+e),r.open("POST",a,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(s),f.textarea.val(""),f.gridBody.removeClass("no-scroll"),w.showSuccess()}},function(){var e=new App.error.Report;$("body").ready(function(){e.initElements(),window.addEventListener("DOMMouseScroll",e.preventDefaultEvent,!1),window.onwheel=e.preventDefaultEvent,window.onmousewheel=document.onmousewheel=e.preventDefaultEvent,window.ontouchmove=e.preventDefaultEvent})}();